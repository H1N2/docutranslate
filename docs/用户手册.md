# DocuTranslate 用户手册

## 快速开始
- 安装：`pip install docutranslate` 或 `pip install docutranslate[docling]`。
- 启动：`docutranslate -i`（默认 8010），或 `docutranslate -i -p 8011`。
- 访问：浏览器打开 `http://127.0.0.1:8010`；API 文档 `http://127.0.0.1:8010/docs`。

## 安装与环境
- Python 3.11+；可用 `uv` 管理环境：`uv add docutranslate`。
- 如使用本地 PDF 解析，选择 `docling` 扩展；在线解析需 `mineru_token`。

## 启动与配置
- 命令行：
  - `docutranslate -i`：启动图形界面（Web UI）。
  - `docutranslate -i -p 8011`：指定端口。
  - 环境变量：`DOCUTRANSLATE_PORT=8011` 后再 `docutranslate -i`。
- 版本：`docutranslate --version`。

## Web UI 使用流程
1. 打开主页，输入 `base_url`、`api_key`、`model_id` 与目标语言。
2. 选择工作流或上传文件（系统自动根据后缀匹配）。
3. 可选：开启术语表生成或上传术语字典；设置并发与分块大小。
4. 提交后在页面查看实时日志与进度；完成后下载结果或附件（术语表）。
5. 如需继续操作，可在浏览器重新打开页面恢复使用。

## API 使用
- 主要端点（Swagger 文档提供完整 Schema）：
  - `POST /service/translate`：提交任务，返回 `task_id`。
  - `GET /service/status/{task_id}`：查询状态。
  - `GET /service/logs/{task_id}`：获取增量日志。
  - `GET /service/download/{task_id}/{file_type}`：下载结果。
  - `GET /service/attachment/{task_id}/{identifier}`：下载附件（如术语表）。
  - `GET /service/content/{task_id}/{file_type}`：以 Base64 JSON 返回内容。
  - `POST /service/cancel/{task_id}` / `POST /service/release/{task_id}`：取消 / 释放任务。

## 命令行提示
```bash
# 打开 GUI（帮助信息见 -h）
docutranslate -i

# 指定端口
# 注：端口默认 8010，可改为任意未占用端口
docutranslate -i -p 8011

# 查看版本
docutranslate --version
```

## 示例：TXT 工作流（Python）
```python
# 中文注释：演示 TXTWorkflow 的异步翻译
import asyncio
from docutranslate.workflow.txt_workflow import TXTWorkflow, TXTWorkflowConfig
from docutranslate.translator.ai_translator.txt_translator import TXTTranslatorConfig
from docutranslate.exporter.txt.txt2html_exporter import TXT2HTMLExporterConfig

async def main():
    # 中文注释：配置翻译器（请替换为你的 API Key）
    translator_config = TXTTranslatorConfig(
        base_url="https://api.openai.com/v1/",
        api_key="YOUR_OPENAI_API_KEY",
        model_id="gpt-4o",
        to_lang="中文",
    )

    # 中文注释：构建工作流配置
    workflow_config = TXTWorkflowConfig(
        translator_config=translator_config,
        html_exporter_config=TXT2HTMLExporterConfig(cdn=True)
    )

    # 中文注释：实例化工作流并执行
    workflow = TXTWorkflow(config=workflow_config)
    workflow.read_path("path/to/your/notes.txt")
    await workflow.translate_async()  # 或 workflow.translate()

    # 中文注释：保存结果
    workflow.save_as_txt(name="translated_notes.txt")

if __name__ == "__main__":
    asyncio.run(main())
```

## JSON 工作流要点
- 通过 JSONPath（`jsonpath-ng`）选择需要翻译的值字段；其他结构保持不变。

## PDF 解析与注意事项
- 在线解析：`mineru_token`（有效期 14 天）。
- 本地解析：`docling` 首次下载模型可能较慢；建议使用发布版资源包。
- 提示：`pdf` 转 `markdown` 会**丢失原始排版**，严格排版场景需后处理。

## 术语表与提示词
- 自动术语表生成（可开关）；支持自定义术语字典。
- 支持自定义提示词，适用于论文与专业领域。

## 常见问题（FAQ）
- 无法启动：检查端口占用或权限；改用 `-p` 指定端口。
- LLM 报错：检查 `base_url`、`api_key`、`model_id` 是否匹配平台。
- mineru 失效：重新申请 token；网络不佳建议改用 `docling`。
- 公式渲染：推荐使用 KaTeX，支持离线。

## 版本与发布
- 提供 Windows/Mac 懒人包（标准版/含 Docling 的完整版）。
- 源码安装与 `uv` 环境支持，适合本地部署与二次开发。

## 附录：支持平台（示例）
- OpenAI、Anthropic、智谱、火山引擎、阿里云百炼、DeepSeek、SiliconFlow、Ollama、LM Studio、302.AI 等（以平台兼容的 OpenAI 风格 API 为准）。